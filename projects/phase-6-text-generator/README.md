# Phase 6 å®æˆ˜é¡¹ç›® - å­—ç¬¦çº§æ–‡æœ¬ç”Ÿæˆå™¨

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

ä½¿ç”¨ **å¤šå±‚ LSTM** å®ç°å­—ç¬¦çº§è¯­è¨€æ¨¡å‹ï¼Œåœ¨ä¸­æ–‡å¤è¯—è¯ä¸Šè®­ç»ƒåå¯ç”Ÿæˆç±»ä¼¼é£æ ¼çš„æ–‡æœ¬ã€‚

## ğŸ¯ å­¦ä¹ ç›®æ ‡

- ç†è§£å­—ç¬¦çº§è¯­è¨€æ¨¡å‹çš„å·¥ä½œåŸç†
- æŒæ¡ LSTM åœ¨åºåˆ—ç”Ÿæˆä»»åŠ¡ä¸­çš„åº”ç”¨
- å­¦ä¹ æ¸©åº¦é‡‡æ · (Temperature Sampling) æŠ€æœ¯
- ç†è§£æ¢¯åº¦è£å‰ªåœ¨ RNN è®­ç»ƒä¸­çš„é‡è¦æ€§

## ğŸ“Š æ•°æ®é›†

**ä¸­æ–‡å¤è¯—è¯**ï¼š

- åŒ…å«çº¦ 30+ é¦–ç»å…¸å”è¯—å®‹è¯
- å­—ç¬¦é›†å¤§å°ï¼šçº¦ 200-300 ä¸ªä¸åŒæ±‰å­—å’Œæ ‡ç‚¹
- è®­ç»ƒæ–‡æœ¬é•¿åº¦ï¼šçº¦ 2000+ å­—ç¬¦

## ğŸ—ï¸ æ¨¡å‹æ¶æ„

**å­—ç¬¦çº§ LSTM è¯­è¨€æ¨¡å‹**ï¼š

```
è¾“å…¥å­—ç¬¦ (1,)
    â†“
Embedding(vocab_size â†’ 128)
    â†“
LSTM(128 â†’ 256, num_layers=2, dropout=0.3)
    â†“
Dropout(0.3)
    â†“
Linear(256 â†’ vocab_size)
    â†“
è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒ
```

### å…³é”®ç»„ä»¶

1. **å­—ç¬¦åµŒå…¥å±‚**ï¼šå°†å­—ç¬¦ç´¢å¼•æ˜ å°„åˆ° 128 ç»´å‘é‡
2. **åŒå±‚ LSTM**ï¼šæ•æ‰å­—ç¬¦åºåˆ—çš„é•¿æœŸä¾èµ–å…³ç³»
3. **æ¸©åº¦é‡‡æ ·**ï¼šæ§åˆ¶ç”Ÿæˆæ–‡æœ¬çš„éšæœºæ€§å’Œå¤šæ ·æ€§
4. **æ¢¯åº¦è£å‰ª**ï¼šé˜²æ­¢æ¢¯åº¦çˆ†ç‚¸ï¼Œé˜ˆå€¼è®¾ä¸º 5.0

## ğŸš€ è¿è¡Œæ–¹å¼

### 1. ç¯å¢ƒå‡†å¤‡

```bash
cd projects/phase-6-text-generator
source ../../.venv/bin/activate
```

### 2. è®­ç»ƒæ¨¡å‹

```bash
python text_generator.py
```

è®­ç»ƒè¿‡ç¨‹ä¼šï¼š

- æ¯ä¸ª epoch æ˜¾ç¤ºæ‰¹æ¬¡æŸå¤±
- æ¯ 10 ä¸ª epoch ç”Ÿæˆæ–‡æœ¬æ ·ä¾‹
- è‡ªåŠ¨ä¿å­˜æœ€ä½³æ¨¡å‹
- ç»˜åˆ¶è®­ç»ƒæŸå¤±æ›²çº¿

### 3. æŸ¥çœ‹ç»“æœ

è®­ç»ƒå®Œæˆåä¼šç”Ÿæˆï¼š

- `outputs/training_loss.png` - è®­ç»ƒæŸå¤±æ›²çº¿
- `outputs/checkpoints/best_model.pth` - æœ€ä½³æ¨¡å‹æƒé‡
- `outputs/generated/generated_samples.txt` - ç”Ÿæˆçš„æ–‡æœ¬æ ·ä¾‹

## ğŸ“ˆ é¢„æœŸç»“æœ

- **è®­ç»ƒæ—¶é—´**ï¼š~5-10 åˆ†é’Ÿ (CPU) / ~2-3 åˆ†é’Ÿ (GPU)
- **æœ€ç»ˆæŸå¤±**ï¼š~1.5-2.0
- **ç”Ÿæˆæ•ˆæœ**ï¼šèƒ½ç”Ÿæˆå…·æœ‰è¯—è¯é£æ ¼çš„æ–‡æœ¬ï¼Œéƒ¨åˆ†ç‰‡æ®µä¸è®­ç»ƒæ•°æ®ç›¸ä¼¼

### ç”Ÿæˆæ–‡æœ¬ç¤ºä¾‹

**èµ·å§‹å­—ç¬¦ï¼šæ˜¥ | æ¸©åº¦=0.8**

```
æ˜¥çœ ä¸è§‰æ™“ï¼Œå¤„å¤„é—»å•¼é¸Ÿã€‚å¤œæ¥é£é›¨å£°ï¼ŒèŠ±è½çŸ¥å¤šå°‘ã€‚
```

**æ¸©åº¦å‚æ•°å½±å“**ï¼š

- `temperature=0.5`ï¼šæ›´ç¡®å®šæ€§ï¼Œé‡å¤æ€§é«˜
- `temperature=0.8`ï¼šå¹³è¡¡ï¼Œè¾ƒä¸ºè‡ªç„¶
- `temperature=1.0`ï¼šæ ‡å‡† softmax
- `temperature=1.2`ï¼šæ›´éšæœºï¼Œåˆ›é€ æ€§é«˜

## âœ… å…³é”®çŸ¥è¯†ç‚¹

### 1. å­—ç¬¦çº§ vs è¯çº§å»ºæ¨¡

**å­—ç¬¦çº§ä¼˜åŠ¿**ï¼š

- è¯æ±‡è¡¨å°ï¼ˆåªéœ€æ‰€æœ‰å­—ç¬¦ï¼‰
- å¯ä»¥ç”Ÿæˆä»»æ„è¯ï¼ŒåŒ…æ‹¬è®­ç»ƒé›†å¤–çš„è¯
- å¯¹æ‹¼å†™é”™è¯¯æ›´é²æ£’

**å­—ç¬¦çº§æŒ‘æˆ˜**ï¼š

- åºåˆ—æ›´é•¿ï¼ˆæ¯ä¸ªè¯ç”±å¤šä¸ªå­—ç¬¦ç»„æˆï¼‰
- éœ€è¦å­¦ä¹ æ›´å¤šåŸºç¡€æ¨¡å¼

### 2. æ¸©åº¦é‡‡æ ·

```python
output = output / temperature
probs = softmax(output)
next_char = sample(probs)
```

æ¸©åº¦ `T` æ§åˆ¶æ¦‚ç‡åˆ†å¸ƒçš„"å¹³å¦åº¦"ï¼š

- `T â†’ 0`ï¼šargmaxï¼Œé€‰æ‹©æ¦‚ç‡æœ€é«˜çš„å­—ç¬¦
- `T = 1`ï¼šæ ‡å‡† softmax
- `T > 1`ï¼šæ›´å¹³å¦çš„åˆ†å¸ƒï¼Œæ›´éšæœº

### 3. æ¢¯åº¦è£å‰ª

```python
nn.utils.clip_grad_norm_(model.parameters(), max_norm=5.0)
```

é˜²æ­¢ RNN/LSTM è®­ç»ƒä¸­çš„æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ã€‚

### 4. åºåˆ—æ•°æ®çš„æ‰¹å¤„ç†

- è¾“å…¥ï¼š`(batch_size, seq_length)` å­—ç¬¦ç´¢å¼•
- ç›®æ ‡ï¼šè¾“å…¥åºåˆ—å‘åç§»åŠ¨ä¸€ä¸ªå­—ç¬¦
- LSTM éœ€è¦åˆå§‹åŒ–éšè—çŠ¶æ€ `h0` å’Œç»†èƒçŠ¶æ€ `c0`

## ğŸ“ é¡¹ç›®ç»“æ„

```
phase-6-text-generator/
â”œâ”€â”€ text_generator.py       # ä¸»ç¨‹åºï¼ˆåŒ…å«æ‰€æœ‰åŠŸèƒ½ï¼‰
â”œâ”€â”€ data/
â”‚   â””â”€â”€ training_text.txt   # è®­ç»ƒæ•°æ®ï¼ˆä¸­æ–‡å¤è¯—è¯ï¼‰
â”œâ”€â”€ outputs/
â”‚   â”œâ”€â”€ training_loss.png   # è®­ç»ƒæ›²çº¿
â”‚   â”œâ”€â”€ checkpoints/        # æ¨¡å‹æƒé‡
â”‚   â”‚   â””â”€â”€ best_model.pth
â”‚   â””â”€â”€ generated/          # ç”Ÿæˆçš„æ–‡æœ¬
â”‚       â””â”€â”€ generated_samples.txt
â””â”€â”€ README.md
```

## ğŸ”§ è¶…å‚æ•°é…ç½®

| å‚æ•°            | å€¼    | è¯´æ˜            |
| --------------- | ----- | --------------- |
| `seq_length`    | 100   | è¾“å…¥åºåˆ—é•¿åº¦    |
| `embed_size`    | 128   | å­—ç¬¦åµŒå…¥ç»´åº¦    |
| `hidden_size`   | 256   | LSTM éšè—å±‚å¤§å° |
| `num_layers`    | 2     | LSTM å±‚æ•°       |
| `dropout`       | 0.3   | Dropout æ¯”ä¾‹    |
| `batch_size`    | 64    | æ‰¹é‡å¤§å°        |
| `learning_rate` | 0.001 | åˆå§‹å­¦ä¹ ç‡      |
| `num_epochs`    | 50    | è®­ç»ƒè½®æ•°        |
| `clip_grad`     | 5.0   | æ¢¯åº¦è£å‰ªé˜ˆå€¼    |

## ğŸš€ æ‰©å±•å»ºè®®

1. **æ›´å¤§çš„æ•°æ®é›†**ï¼šä½¿ç”¨æ›´å¤šçš„æ–‡æœ¬æ•°æ®ï¼ˆå°è¯´ã€æ–‡ç« ï¼‰
2. **å¤šå±‚ LSTM**ï¼šå¢åŠ  LSTM å±‚æ•°ï¼ˆ3-4 å±‚ï¼‰
3. **æ³¨æ„åŠ›æœºåˆ¶**ï¼šæ·»åŠ æ³¨æ„åŠ›å±‚æå‡é•¿æœŸä¾èµ–å»ºæ¨¡
4. **åŒå‘ LSTM**ï¼šè™½ç„¶ç”Ÿæˆä»»åŠ¡ä¸é€‚ç”¨ï¼Œä½†å¯ç”¨äºå…¶ä»–ä»»åŠ¡
5. **Beam Search**ï¼šä½¿ç”¨ Beam Search æ›¿ä»£è´ªå¿ƒé‡‡æ ·

## ğŸ“– å‚è€ƒèµ„æ–™

- [Understanding LSTM Networks - colah's blog](https://colah.github.io/posts/2015-08-Understanding-LSTMs/)
- [The Unreasonable Effectiveness of Recurrent Neural Networks](http://karpathy.github.io/2015/05/21/rnn-effectiveness/)
- PyTorch å®˜æ–¹æ–‡æ¡£ï¼š[nn.LSTM](https://pytorch.org/docs/stable/generated/torch.nn.LSTM.html)

## ğŸ’¡ å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆç”Ÿæˆçš„æ–‡æœ¬é‡å¤æ€§å¾ˆé«˜ï¼Ÿ**  
A: å°è¯•å¢åŠ æ¸©åº¦å‚æ•°ï¼ˆå¦‚ 1.2ï¼‰ï¼Œæˆ–è®­ç»ƒæ›´é•¿æ—¶é—´ï¼Œä½¿ç”¨æ›´å¤šæ•°æ®ã€‚

**Q: å¦‚ä½•åŠ è½½å·²ä¿å­˜çš„æ¨¡å‹ç»§ç»­è®­ç»ƒï¼Ÿ**  
A: ä¿®æ”¹ä»£ç åŠ è½½ `best_model.pth` ä¸­çš„ `model_state_dict` å’Œ `optimizer_state_dict`ã€‚

**Q: å¯ä»¥ç”¨è‹±æ–‡æ•°æ®å—ï¼Ÿ**  
A: å®Œå…¨å¯ä»¥ï¼åªéœ€æ›¿æ¢ `training_text.txt` çš„å†…å®¹å³å¯ã€‚

---

**å®Œæˆæ—¶é—´**ï¼š2024-01-15  
**Phase**ï¼š6 - RNN/LSTM  
**éš¾åº¦**ï¼šâ­â­â­
