"""
04-pandas-basics.py
Phase 1: Python æ•°æ®ç§‘å­¦åŸºç¡€

Pandas åŸºç¡€ï¼šDataFrame æ“ä½œ

å­¦ä¹ ç›®æ ‡ï¼š
1. ç†è§£ DataFrame å’Œ Series æ•°æ®ç»“æ„
2. æŒæ¡æ•°æ®è¯»å–å’ŒåŸºæœ¬æ“ä½œ
3. å­¦ä¹ æ•°æ®ç­›é€‰å’Œç´¢å¼•
4. æŒæ¡æ•°æ®ç»Ÿè®¡å’Œåˆ†ç»„
"""

import pandas as pd
import numpy as np

print("=" * 50)
print("Pandas åŸºç¡€æ“ä½œ")
print("=" * 50)

# =============================================================================
# 1. åˆ›å»º DataFrame
# =============================================================================
print("\nã€1. åˆ›å»º DataFrameã€‘")

# ä»å­—å…¸åˆ›å»º
data = {
    'name': ['Alice', 'Bob', 'Charlie', 'David', 'Eva'],
    'age': [25, 30, 35, 28, 32],
    'city': ['åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·', 'æ·±åœ³', 'æ­å·'],
    'salary': [10000, 15000, 20000, 12000, 18000]
}
df = pd.DataFrame(data)
print("ä»å­—å…¸åˆ›å»º DataFrame:")
print(df)
print()

# ä» NumPy æ•°ç»„åˆ›å»º
arr = np.random.randint(1, 100, size=(4, 3))
df_from_array = pd.DataFrame(arr, columns=['A', 'B', 'C'])
print("ä» NumPy æ•°ç»„åˆ›å»º:")
print(df_from_array)

# =============================================================================
# 2. åŸºæœ¬å±æ€§å’Œæ–¹æ³•
# =============================================================================
print("\n" + "=" * 50)
print("ã€2. åŸºæœ¬å±æ€§å’Œæ–¹æ³•ã€‘")

print(f"å½¢çŠ¶: {df.shape}")
print(f"åˆ—å: {df.columns.tolist()}")
print(f"ç´¢å¼•: {df.index.tolist()}")
print(f"æ•°æ®ç±»å‹:\n{df.dtypes}")

print("\nå‰ä¸¤è¡Œ df.head(2):")
print(df.head(2))

print("\nåä¸¤è¡Œ df.tail(2):")
print(df.tail(2))

print("\nç»Ÿè®¡æ‘˜è¦ df.describe():")
print(df.describe())

print("\nåŸºæœ¬ä¿¡æ¯ df.info():")
df.info()

# =============================================================================
# 3. åˆ—æ“ä½œ
# =============================================================================
print("\n" + "=" * 50)
print("ã€3. åˆ—æ“ä½œã€‘")

# é€‰æ‹©å•åˆ—ï¼ˆè¿”å› Seriesï¼‰
print("é€‰æ‹©å•åˆ— df['name']:")
print(df['name'])
print(f"ç±»å‹: {type(df['name'])}")

# é€‰æ‹©å¤šåˆ—ï¼ˆè¿”å› DataFrameï¼‰
print("\né€‰æ‹©å¤šåˆ— df[['name', 'age']]:")
print(df[['name', 'age']])

# æ·»åŠ æ–°åˆ—
df['bonus'] = df['salary'] * 0.1
print("\næ·»åŠ æ–°åˆ— (bonus = salary * 0.1):")
print(df)

# åˆ é™¤åˆ—
df_dropped = df.drop('bonus', axis=1)
print("\nåˆ é™¤åˆ—å (ä¸æ”¹å˜åŸ df):")
print(df_dropped)

# =============================================================================
# 4. è¡Œæ“ä½œä¸ç´¢å¼•
# =============================================================================
print("\n" + "=" * 50)
print("ã€4. è¡Œæ“ä½œä¸ç´¢å¼•ã€‘")

# loc: åŸºäºæ ‡ç­¾ç´¢å¼•
print("loc[0] - ç¬¬ä¸€è¡Œ:")
print(df.loc[0])

print("\nloc[0:2] - ç¬¬0åˆ°2è¡Œ (åŒ…å«2):")
print(df.loc[0:2])

# iloc: åŸºäºä½ç½®ç´¢å¼•
print("\niloc[0] - ç¬¬ä¸€è¡Œ:")
print(df.iloc[0])

print("\niloc[0:2] - ç¬¬0åˆ°2è¡Œ (ä¸åŒ…å«2):")
print(df.iloc[0:2])

# åŒæ—¶é€‰æ‹©è¡Œå’Œåˆ—
print("\nloc[0:2, ['name', 'salary']]:")
print(df.loc[0:2, ['name', 'salary']])

print("""
ğŸ’¡ loc vs iloc:
- loc: åŸºäºæ ‡ç­¾ï¼ŒåŒ…å«ç»“æŸä½ç½®
- iloc: åŸºäºä½ç½®ï¼Œä¸åŒ…å«ç»“æŸä½ç½®
""")

# =============================================================================
# 5. æ¡ä»¶ç­›é€‰
# =============================================================================
print("=" * 50)
print("ã€5. æ¡ä»¶ç­›é€‰ã€‘")

# å•æ¡ä»¶
print("å¹´é¾„å¤§äº30:")
print(df[df['age'] > 30])

# å¤šæ¡ä»¶ï¼ˆ& å’Œ |ï¼‰
print("\nå¹´é¾„å¤§äº25 ä¸” è–ªèµ„å¤§äº12000:")
print(df[(df['age'] > 25) & (df['salary'] > 12000)])

# ä½¿ç”¨ isin
print("\nåŸå¸‚åœ¨ ['åŒ—äº¬', 'ä¸Šæµ·']:")
print(df[df['city'].isin(['åŒ—äº¬', 'ä¸Šæµ·'])])

# ä½¿ç”¨ query (æ›´ç›´è§‚çš„è¯­æ³•)
print("\nquery è¯­æ³• 'age > 30':")
print(df.query('age > 30'))

# =============================================================================
# 6. æ’åº
# =============================================================================
print("\n" + "=" * 50)
print("ã€6. æ’åºã€‘")

# æŒ‰å•åˆ—æ’åº
print("æŒ‰è–ªèµ„é™åºæ’åº:")
print(df.sort_values('salary', ascending=False))

# æŒ‰å¤šåˆ—æ’åº
print("\næŒ‰åŸå¸‚å‡åºï¼Œè–ªèµ„é™åºæ’åº:")
print(df.sort_values(['city', 'salary'], ascending=[True, False]))

# =============================================================================
# 7. åˆ†ç»„ä¸èšåˆ
# =============================================================================
print("\n" + "=" * 50)
print("ã€7. åˆ†ç»„ä¸èšåˆã€‘")

# åˆ›å»ºå¸¦åˆ†ç±»çš„æ•°æ®
data = {
    'department': ['æŠ€æœ¯', 'æŠ€æœ¯', 'é”€å”®', 'é”€å”®', 'æŠ€æœ¯', 'é”€å”®'],
    'name': ['Alice', 'Bob', 'Charlie', 'David', 'Eva', 'Frank'],
    'salary': [10000, 15000, 12000, 11000, 18000, 13000]
}
df_dept = pd.DataFrame(data)
print("éƒ¨é—¨æ•°æ®:")
print(df_dept)

# åˆ†ç»„èšåˆ
print("\næŒ‰éƒ¨é—¨ç»Ÿè®¡è–ªèµ„å‡å€¼:")
print(df_dept.groupby('department')['salary'].mean())

print("\næŒ‰éƒ¨é—¨ç»Ÿè®¡å¤šä¸ªèšåˆ:")
print(df_dept.groupby('department')['salary'].agg(['mean', 'sum', 'count', 'max', 'min']))

# =============================================================================
# 8. ç¼ºå¤±å€¼å¤„ç†ï¼ˆé¢„è§ˆï¼‰
# =============================================================================
print("\n" + "=" * 50)
print("ã€8. ç¼ºå¤±å€¼å¤„ç†ï¼ˆé¢„è§ˆï¼‰ã€‘")

# åˆ›å»ºå«ç¼ºå¤±å€¼çš„æ•°æ®
data_with_nan = {
    'A': [1, 2, np.nan, 4],
    'B': [5, np.nan, np.nan, 8],
    'C': [9, 10, 11, 12]
}
df_nan = pd.DataFrame(data_with_nan)
print("å«ç¼ºå¤±å€¼çš„æ•°æ®:")
print(df_nan)

print(f"\nç»Ÿè®¡ç¼ºå¤±å€¼:\n{df_nan.isnull().sum()}")

# å¡«å……ç¼ºå¤±å€¼
print("\nç”¨å‡å€¼å¡«å……ç¼ºå¤±å€¼:")
print(df_nan.fillna(df_nan.mean()))

# åˆ é™¤å«ç¼ºå¤±å€¼çš„è¡Œ
print("\nåˆ é™¤å«ç¼ºå¤±å€¼çš„è¡Œ:")
print(df_nan.dropna())

print("""
ğŸ’¡ ç¼ºå¤±å€¼å¤„ç†ç­–ç•¥ï¼š
- fillna(value): ç”¨æŒ‡å®šå€¼å¡«å……
- fillna(method='ffill'): ç”¨å‰ä¸€ä¸ªå€¼å¡«å……
- dropna(): åˆ é™¤å«ç¼ºå¤±å€¼çš„è¡Œ
- interpolate(): æ’å€¼å¡«å……
""")

# =============================================================================
# 9. ç»ƒä¹ é¢˜
# =============================================================================
print("=" * 50)
print("ã€ç»ƒä¹ é¢˜ã€‘")
print("=" * 50)

print("""
1. åˆ›å»ºä¸€ä¸ªåŒ…å« 10 åå­¦ç”Ÿçš„æˆç»©è¡¨ï¼ˆå§“åã€æ•°å­¦ã€è¯­æ–‡ã€è‹±è¯­ï¼‰
   è®¡ç®—æ¯ä¸ªå­¦ç”Ÿçš„æ€»åˆ†å’Œå¹³å‡åˆ†

2. ç­›é€‰å‡ºæ•°å­¦æˆç»©å¤§äº 80 ä¸”è‹±è¯­æˆç»©å¤§äº 85 çš„å­¦ç”Ÿ

3. æŒ‰æ€»åˆ†é™åºæ’åˆ—ï¼Œæ‰¾å‡ºå‰ 3 å

4. æ·»åŠ ä¸€åˆ— 'ç­‰çº§'ï¼šå¹³å‡åˆ† >= 90 ä¸º Aï¼Œ>= 80 ä¸º Bï¼Œ>= 60 ä¸º Cï¼Œå¦åˆ™ä¸º D
   æç¤ºï¼šå¯ä»¥ä½¿ç”¨ pd.cut() æˆ– np.where()

è¯·åœ¨ä¸‹æ–¹ç¼–å†™ä»£ç å®Œæˆç»ƒä¹ ...
""")

# === åœ¨è¿™é‡Œç¼–å†™ä½ çš„ç»ƒä¹ ä»£ç  ===
# ç»ƒä¹  1
# np.random.seed(42)
# students = pd.DataFrame({
#     'name': [f'å­¦ç”Ÿ{i+1}' for i in range(10)],
#     'math': np.random.randint(60, 100, 10),
#     'chinese': np.random.randint(60, 100, 10),
#     'english': np.random.randint(60, 100, 10)
# })
# students['total'] = students['math'] + students['chinese'] + students['english']
# students['average'] = students[['math', 'chinese', 'english']].mean(axis=1)
# print(students)

# ç»ƒä¹  2
# filtered = students[(students['math'] > 80) & (students['english'] > 85)]
# print(f"æ•°å­¦>80 ä¸” è‹±è¯­>85:\n{filtered}")

# ç»ƒä¹  3
# top3 = students.sort_values('total', ascending=False).head(3)
# print(f"æ€»åˆ†å‰3å:\n{top3}")

# ç»ƒä¹  4
# def get_grade(avg):
#     if avg >= 90:
#         return 'A'
#     elif avg >= 80:
#         return 'B'
#     elif avg >= 60:
#         return 'C'
#     else:
#         return 'D'
# 
# students['grade'] = students['average'].apply(get_grade)
# # æˆ–è€…ä½¿ç”¨ pd.cut:
# # students['grade'] = pd.cut(students['average'], 
# #                           bins=[0, 60, 80, 90, 100], 
# #                           labels=['D', 'C', 'B', 'A'])
# print(students)

print("\nâœ… Pandas åŸºç¡€æ“ä½œå®Œæˆï¼")
print("ä¸‹ä¸€æ­¥ï¼š05-pandas-preprocessing.py - æ•°æ®æ¸…æ´—ä¸é¢„å¤„ç†")
