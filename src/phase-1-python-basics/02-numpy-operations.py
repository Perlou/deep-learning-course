"""
02-numpy-operations.py
Phase 1: Python æ•°æ®ç§‘å­¦åŸºç¡€

NumPy è¿ç®—ï¼šçŸ©é˜µè¿ç®—ã€å¹¿æ’­æœºåˆ¶

å­¦ä¹ ç›®æ ‡ï¼š
1. æŒæ¡æ•°ç»„çš„åŸºæœ¬è¿ç®—ï¼ˆåŠ å‡ä¹˜é™¤ï¼‰
2. ç†è§£å¹¿æ’­æœºåˆ¶ (Broadcasting)
3. å­¦ä¹ å¸¸ç”¨çš„æ•°å­¦å‡½æ•°
4. ç†è§£å‘é‡åŒ–æ“ä½œçš„ä¼˜åŠ¿
"""

import numpy as np
import time

print("=" * 50)
print("NumPy è¿ç®—ä¸å¹¿æ’­æœºåˆ¶")
print("=" * 50)

# =============================================================================
# 1. åŸºæœ¬è¿ç®—
# =============================================================================
print("\nã€1. åŸºæœ¬è¿ç®—ï¼ˆå…ƒç´ çº§ï¼‰ã€‘")

a = np.array([1, 2, 3, 4])
b = np.array([5, 6, 7, 8])

print(f"a = {a}")
print(f"b = {b}")
print(f"a + b = {a + b}")  # å…ƒç´ çº§åŠ æ³•
print(f"a - b = {a - b}")  # å…ƒç´ çº§å‡æ³•
print(f"a * b = {a * b}")  # å…ƒç´ çº§ä¹˜æ³•ï¼ˆæ³¨æ„ï¼šä¸æ˜¯çŸ©é˜µä¹˜æ³•ï¼ï¼‰
print(f"a / b = {a / b}")  # å…ƒç´ çº§é™¤æ³•
print(f"a ** 2 = {a ** 2}")  # å…ƒç´ çº§å¹‚è¿ç®—

# =============================================================================
# 2. å¹¿æ’­æœºåˆ¶ (Broadcasting)
# =============================================================================
print("\n" + "=" * 50)
print("ã€2. å¹¿æ’­æœºåˆ¶ (Broadcasting)ã€‘")

# æ ‡é‡ä¸æ•°ç»„
arr = np.array([1, 2, 3])
print(f"arr = {arr}")
print(f"arr + 10 = {arr + 10}")  # æ ‡é‡å¹¿æ’­åˆ°æ‰€æœ‰å…ƒç´ 
print(f"arr * 2 = {arr * 2}")

# ä¸åŒå½¢çŠ¶çš„æ•°ç»„å¹¿æ’­
arr_2d = np.array([[1, 2, 3],
                   [4, 5, 6]])
arr_1d = np.array([10, 20, 30])

print(f"\narr_2d (2x3):\n{arr_2d}")
print(f"arr_1d (3,): {arr_1d}")
print(f"arr_2d + arr_1d (å¹¿æ’­):\n{arr_2d + arr_1d}")

# å¹¿æ’­è§„åˆ™è¯´æ˜
print("""
ğŸ“– å¹¿æ’­è§„åˆ™ï¼š
1. å¦‚æœä¸¤ä¸ªæ•°ç»„ç»´åº¦æ•°ä¸åŒï¼Œåœ¨è¾ƒå°æ•°ç»„çš„å‰é¢è¡¥ 1
2. å¦‚æœä¸¤ä¸ªæ•°ç»„åœ¨æŸç»´åº¦å¤§å°ä¸åŒï¼Œä¸”å…¶ä¸­ä¸€ä¸ªä¸º 1ï¼Œåˆ™æ²¿è¯¥ç»´åº¦æ‰©å±•
3. å¦‚æœä¸¤ä¸ªæ•°ç»„åœ¨æŸç»´åº¦å¤§å°ä¸åŒä¸”éƒ½ä¸ä¸º 1ï¼Œåˆ™æŠ¥é”™

ç¤ºä¾‹ï¼š
- (2, 3) + (3,) â†’ (2, 3) + (1, 3) â†’ (2, 3)
- (4, 1) + (3,) â†’ (4, 1) + (1, 3) â†’ (4, 3)
""")

# =============================================================================
# 3. çŸ©é˜µè¿ç®—
# =============================================================================
print("=" * 50)
print("ã€3. çŸ©é˜µè¿ç®—ã€‘")

A = np.array([[1, 2], [3, 4]])
B = np.array([[5, 6], [7, 8]])

print(f"A:\n{A}")
print(f"B:\n{B}")

# çŸ©é˜µä¹˜æ³•
print(f"\nçŸ©é˜µä¹˜æ³• A @ B:\n{A @ B}")
print(f"çŸ©é˜µä¹˜æ³• np.matmul(A, B):\n{np.matmul(A, B)}")
print(f"çŸ©é˜µä¹˜æ³• np.dot(A, B):\n{np.dot(A, B)}")

# æ³¨æ„åŒºåˆ†ï¼šå…ƒç´ çº§ä¹˜æ³• vs çŸ©é˜µä¹˜æ³•
print(f"\nå…ƒç´ çº§ä¹˜æ³• A * B:\n{A * B}")

# è½¬ç½®
print(f"\nA çš„è½¬ç½® A.T:\n{A.T}")

# =============================================================================
# 4. èšåˆå‡½æ•°
# =============================================================================
print("\n" + "=" * 50)
print("ã€4. èšåˆå‡½æ•°ã€‘")

arr = np.array([[1, 2, 3], [4, 5, 6]])
print(f"arr:\n{arr}")

print(f"\nå…¨å±€èšåˆï¼š")
print(f"  æ±‚å’Œ np.sum(arr): {np.sum(arr)}")
print(f"  å‡å€¼ np.mean(arr): {np.mean(arr)}")
print(f"  æœ€å¤§å€¼ np.max(arr): {np.max(arr)}")
print(f"  æœ€å°å€¼ np.min(arr): {np.min(arr)}")
print(f"  æ ‡å‡†å·® np.std(arr): {np.std(arr):.4f}")

print(f"\næŒ‰è½´èšåˆï¼š")
print(f"  æŒ‰è¡Œæ±‚å’Œ (axis=0): {np.sum(arr, axis=0)}")  # æ¯åˆ—çš„å’Œ
print(f"  æŒ‰åˆ—æ±‚å’Œ (axis=1): {np.sum(arr, axis=1)}")  # æ¯è¡Œçš„å’Œ

# =============================================================================
# 5. å¸¸ç”¨æ•°å­¦å‡½æ•°
# =============================================================================
print("\n" + "=" * 50)
print("ã€5. å¸¸ç”¨æ•°å­¦å‡½æ•°ã€‘")

arr = np.array([0, np.pi/6, np.pi/4, np.pi/3, np.pi/2])
print(f"è§’åº¦ (å¼§åº¦): {arr}")
print(f"sin: {np.sin(arr)}")
print(f"cos: {np.cos(arr)}")

arr = np.array([1, 2, 3, 4, 5])
print(f"\nåŸæ•°ç»„: {arr}")
print(f"æŒ‡æ•° np.exp(arr): {np.exp(arr)}")
print(f"å¯¹æ•° np.log(arr): {np.log(arr)}")
print(f"å¹³æ–¹æ ¹ np.sqrt(arr): {np.sqrt(arr)}")

# =============================================================================
# 6. å‘é‡åŒ–çš„ä¼˜åŠ¿
# =============================================================================
print("\n" + "=" * 50)
print("ã€6. å‘é‡åŒ–çš„ä¼˜åŠ¿ã€‘")

# æ¯”è¾ƒå¾ªç¯ vs å‘é‡åŒ–çš„æ€§èƒ½
size = 1000000
arr = np.random.randn(size)

# ä½¿ç”¨å¾ªç¯
start = time.time()
result_loop = []
for x in arr:
    result_loop.append(x * 2 + 1)
loop_time = time.time() - start

# ä½¿ç”¨å‘é‡åŒ–
start = time.time()
result_vec = arr * 2 + 1
vec_time = time.time() - start

print(f"æ•°ç»„å¤§å°: {size:,}")
print(f"å¾ªç¯è€—æ—¶: {loop_time:.4f} ç§’")
print(f"å‘é‡åŒ–è€—æ—¶: {vec_time:.6f} ç§’")
print(f"åŠ é€Ÿæ¯”: {loop_time / vec_time:.1f}x")

print("""
ğŸ’¡ ä¸ºä»€ä¹ˆå‘é‡åŒ–æ›´å¿«ï¼Ÿ
1. NumPy åº•å±‚ä½¿ç”¨ C/Fortran å®ç°
2. é¿å… Python å¾ªç¯çš„å¼€é”€
3. åˆ©ç”¨ CPU çš„ SIMD æŒ‡ä»¤å¹¶è¡Œè®¡ç®—
4. å†…å­˜è®¿é—®æ›´åŠ è¿ç»­é«˜æ•ˆ
""")

# =============================================================================
# 7. ç»ƒä¹ é¢˜
# =============================================================================
print("=" * 50)
print("ã€ç»ƒä¹ é¢˜ã€‘")
print("=" * 50)

print("""
1. åˆ›å»ºä¸¤ä¸ª 3x3 çŸ©é˜µ A å’Œ Bï¼Œè®¡ç®—å®ƒä»¬çš„çŸ©é˜µä¹˜æ³•

2. ä½¿ç”¨å¹¿æ’­æœºåˆ¶ï¼Œå°† 3x4 çŸ©é˜µçš„æ¯ä¸€åˆ—å‡å»è¯¥åˆ—çš„å‡å€¼ï¼ˆæ ‡å‡†åŒ–ï¼‰

3. ç»™å®šæ•°ç»„ [1, 2, 3, 4, 5]ï¼Œè®¡ç®—ï¼š
   - æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯
   - ç´¯ç§¯å’Œï¼ˆcumsumï¼‰
   
4. å®ç° Softmax å‡½æ•°ï¼šsoftmax(x) = exp(x) / sum(exp(x))
   æç¤ºï¼šæ³¨æ„æ•°å€¼ç¨³å®šæ€§ï¼Œå¯ä»¥å…ˆå‡å»æœ€å¤§å€¼

è¯·åœ¨ä¸‹æ–¹ç¼–å†™ä»£ç å®Œæˆç»ƒä¹ ...
""")

# === åœ¨è¿™é‡Œç¼–å†™ä½ çš„ç»ƒä¹ ä»£ç  ===
# ç»ƒä¹  1
# A = np.random.randint(1, 10, (3, 3))
# B = np.random.randint(1, 10, (3, 3))
# print(f"A:\n{A}")
# print(f"B:\n{B}")
# print(f"A @ B:\n{A @ B}")

# ç»ƒä¹  2
# matrix = np.random.randn(3, 4)
# print(f"åŸçŸ©é˜µ:\n{matrix}")
# # æ¯åˆ—å‡å»è¯¥åˆ—çš„å‡å€¼ï¼ˆæ ‡å‡†åŒ–ï¼‰
# normalized = matrix - np.mean(matrix, axis=0)
# print(f"æ ‡å‡†åŒ–å:\n{normalized}")
# print(f"éªŒè¯åˆ—å‡å€¼æ¥è¿‘0: {np.mean(normalized, axis=0)}")

# ç»ƒä¹  3
# arr = np.array([1, 2, 3, 4, 5])
# print(f"åŸæ•°ç»„: {arr}")
# print(f"æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯: {np.prod(arr)}")  # 120
# print(f"ç´¯ç§¯å’Œ: {np.cumsum(arr)}")  # [1, 3, 6, 10, 15]

# ç»ƒä¹  4
# def softmax(x):
#     # æ•°å€¼ç¨³å®šæ€§ï¼šå‡å»æœ€å¤§å€¼é˜²æ­¢ exp æº¢å‡º
#     x_shifted = x - np.max(x)
#     exp_x = np.exp(x_shifted)
#     return exp_x / np.sum(exp_x)
# 
# x = np.array([1, 2, 3, 4, 5])
# print(f"x = {x}")
# print(f"softmax(x) = {softmax(x)}")
# print(f"éªŒè¯å’Œä¸º1: {np.sum(softmax(x))}")

print("\nâœ… NumPy è¿ç®—ä¸å¹¿æ’­æœºåˆ¶å®Œæˆï¼")
print("ä¸‹ä¸€æ­¥ï¼š03-numpy-linear-algebra.py - çº¿æ€§ä»£æ•°æ“ä½œ")
