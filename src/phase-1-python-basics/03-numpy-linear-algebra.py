"""
03-numpy-linear-algebra.py
Phase 1: Python æ•°æ®ç§‘å­¦åŸºç¡€

NumPy çº¿æ€§ä»£æ•°ï¼šçŸ©é˜µè¿ç®—ã€ç‰¹å¾å€¼ã€SVD

å­¦ä¹ ç›®æ ‡ï¼š
1. æŒæ¡çŸ©é˜µçš„åŸºæœ¬çº¿æ€§ä»£æ•°è¿ç®—
2. ç†è§£ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡çš„æ„ä¹‰
3. äº†è§£ SVD åˆ†è§£çš„åº”ç”¨
4. ä¸ºæ·±åº¦å­¦ä¹ çš„æ•°å­¦åŸºç¡€åšå‡†å¤‡
"""

import numpy as np

print("=" * 50)
print("NumPy çº¿æ€§ä»£æ•°æ“ä½œ")
print("=" * 50)

# =============================================================================
# 1. çŸ©é˜µåŸºæœ¬è¿ç®—
# =============================================================================
print("\nã€1. çŸ©é˜µåŸºæœ¬è¿ç®—ã€‘")

A = np.array([[1, 2], [3, 4]])
print(f"çŸ©é˜µ A:\n{A}")

# è½¬ç½®
print(f"\nè½¬ç½® A.T:\n{A.T}")

# çŸ©é˜µçš„é€†
A_inv = np.linalg.inv(A)
print(f"\né€†çŸ©é˜µ Aâ»Â¹:\n{A_inv}")

# éªŒè¯ï¼šA Ã— Aâ»Â¹ = I
print(f"\néªŒè¯ A @ Aâ»Â¹ â‰ˆ I:\n{A @ A_inv}")

# è¡Œåˆ—å¼
det = np.linalg.det(A)
print(f"\nè¡Œåˆ—å¼ det(A) = {det}")

# çŸ©é˜µçš„ç§©
rank = np.linalg.matrix_rank(A)
print(f"ç§© rank(A) = {rank}")

# çŸ©é˜µçš„è¿¹ï¼ˆå¯¹è§’çº¿å…ƒç´ ä¹‹å’Œï¼‰
trace = np.trace(A)
print(f"è¿¹ trace(A) = {trace}")

# =============================================================================
# 2. è§£çº¿æ€§æ–¹ç¨‹ç»„
# =============================================================================
print("\n" + "=" * 50)
print("ã€2. è§£çº¿æ€§æ–¹ç¨‹ç»„ Ax = bã€‘")

# 2x + 3y = 8
# 4x + 5y = 14
A = np.array([[2, 3], [4, 5]])
b = np.array([8, 14])

x = np.linalg.solve(A, b)
print(f"A:\n{A}")
print(f"b: {b}")
print(f"è§£ x: {x}")
print(f"éªŒè¯ A @ x = {A @ x}")

# =============================================================================
# 3. ç‰¹å¾å€¼ä¸ç‰¹å¾å‘é‡
# =============================================================================
print("\n" + "=" * 50)
print("ã€3. ç‰¹å¾å€¼ä¸ç‰¹å¾å‘é‡ã€‘")

A = np.array([[4, 2], [1, 3]])
print(f"çŸ©é˜µ A:\n{A}")

eigenvalues, eigenvectors = np.linalg.eig(A)
print(f"\nç‰¹å¾å€¼: {eigenvalues}")
print(f"ç‰¹å¾å‘é‡:\n{eigenvectors}")

# éªŒè¯ï¼šA @ v = Î» @ v
print("\néªŒè¯ A @ v = Î» Ã— v:")
for i in range(len(eigenvalues)):
    v = eigenvectors[:, i]
    Î» = eigenvalues[i]
    Av = A @ v
    Î»v = Î» * v
    print(f"  Î»{i+1} = {Î»:.2f}")
    print(f"  A @ v{i+1} = {Av}")
    print(f"  Î»{i+1} Ã— v{i+1} = {Î»v}")
    print()

print("""
ğŸ’¡ ç‰¹å¾å€¼/ç‰¹å¾å‘é‡åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„åº”ç”¨ï¼š
1. PCA é™ç»´ - æ‰¾æ•°æ®çš„ä¸»æ–¹å‘
2. åæ–¹å·®çŸ©é˜µåˆ†æ - ç†è§£æ•°æ®åˆ†å¸ƒ
3. æ¨¡å‹ä¼˜åŒ– - ç†è§£ Hessian çŸ©é˜µçš„æ›²ç‡
""")

# =============================================================================
# 4. å¥‡å¼‚å€¼åˆ†è§£ (SVD)
# =============================================================================
print("=" * 50)
print("ã€4. å¥‡å¼‚å€¼åˆ†è§£ (SVD)ã€‘")

# åˆ›å»ºä¸€ä¸ªç®€å•çš„çŸ©é˜µ
A = np.array([[1, 2, 3],
              [4, 5, 6],
              [7, 8, 9]])
print(f"çŸ©é˜µ A:\n{A}")

# SVD åˆ†è§£: A = U @ Î£ @ V^T
U, s, Vt = np.linalg.svd(A)
print(f"\nU (å·¦å¥‡å¼‚å‘é‡):\n{U}")
print(f"\nå¥‡å¼‚å€¼ (Ïƒ): {s}")
print(f"\nV^T (å³å¥‡å¼‚å‘é‡è½¬ç½®):\n{Vt}")

# é‡æ„çŸ©é˜µ
Sigma = np.zeros_like(A, dtype=float)
np.fill_diagonal(Sigma, s)
A_reconstructed = U @ Sigma @ Vt
print(f"\né‡æ„ A = U @ Î£ @ V^T:\n{A_reconstructed}")

print("""
ğŸ’¡ SVD åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„åº”ç”¨ï¼š
1. çŸ©é˜µä½ç§©è¿‘ä¼¼ - æ¨¡å‹å‹ç¼©
2. æ¨èç³»ç»Ÿ - ååŒè¿‡æ»¤
3. LoRA å¾®è°ƒ - ä½ç§©é€‚é…
""")

# =============================================================================
# 5. èŒƒæ•° (Norm)
# =============================================================================
print("=" * 50)
print("ã€5. èŒƒæ•° (Norm)ã€‘")

v = np.array([3, 4])
print(f"å‘é‡ v: {v}")

# L1 èŒƒæ•°ï¼ˆæ›¼å“ˆé¡¿è·ç¦»ï¼‰
l1 = np.linalg.norm(v, ord=1)
print(f"L1 èŒƒæ•° ||v||â‚ = |3| + |4| = {l1}")

# L2 èŒƒæ•°ï¼ˆæ¬§å‡ é‡Œå¾—è·ç¦»ï¼‰
l2 = np.linalg.norm(v, ord=2)
print(f"L2 èŒƒæ•° ||v||â‚‚ = âˆš(3Â² + 4Â²) = {l2}")

# æ— ç©·èŒƒæ•°
linf = np.linalg.norm(v, ord=np.inf)
print(f"Lâˆ èŒƒæ•° = max(|3|, |4|) = {linf}")

# çŸ©é˜µçš„ Frobenius èŒƒæ•°
A = np.array([[1, 2], [3, 4]])
fro = np.linalg.norm(A, 'fro')
print(f"\nçŸ©é˜µ Frobenius èŒƒæ•° = âˆš(1Â² + 2Â² + 3Â² + 4Â²) = {fro:.4f}")

print("""
ğŸ’¡ èŒƒæ•°åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„åº”ç”¨ï¼š
1. L2 æ­£åˆ™åŒ– - æƒé‡è¡°å‡ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ
2. L1 æ­£åˆ™åŒ– - ç¨€ç–æ€§ï¼Œç‰¹å¾é€‰æ‹©
3. æ¢¯åº¦è£å‰ª - é˜²æ­¢æ¢¯åº¦çˆ†ç‚¸
""")

# =============================================================================
# 6. å®é™…åº”ç”¨ç¤ºä¾‹ï¼šPCA é™ç»´
# =============================================================================
print("=" * 50)
print("ã€6. å®é™…åº”ç”¨ï¼šPCA é™ç»´ã€‘")

# ç”Ÿæˆä¸€äº› 2D æ•°æ®ç‚¹
np.random.seed(42)
n_samples = 100
mean = [5, 5]
cov = [[3, 2], [2, 2]]  # åæ–¹å·®çŸ©é˜µï¼ˆæ­£ç›¸å…³ï¼‰
data = np.random.multivariate_normal(mean, cov, n_samples)
print(f"åŸå§‹æ•°æ®å½¢çŠ¶: {data.shape}")

# 1. ä¸­å¿ƒåŒ–
data_centered = data - np.mean(data, axis=0)

# 2. è®¡ç®—åæ–¹å·®çŸ©é˜µ
cov_matrix = np.cov(data_centered.T)
print(f"åæ–¹å·®çŸ©é˜µ:\n{cov_matrix}")

# 3. ç‰¹å¾åˆ†è§£
eigenvalues, eigenvectors = np.linalg.eig(cov_matrix)
print(f"\nç‰¹å¾å€¼: {eigenvalues}")
print(f"ç‰¹å¾å‘é‡:\n{eigenvectors}")

# 4. é€‰æ‹©ä¸»æˆåˆ†ï¼ˆæŒ‰ç‰¹å¾å€¼å¤§å°æ’åºï¼‰
idx = np.argsort(eigenvalues)[::-1]
sorted_eigenvalues = eigenvalues[idx]
sorted_eigenvectors = eigenvectors[:, idx]

print(f"\næ’åºåçš„ç‰¹å¾å€¼: {sorted_eigenvalues}")
print(f"æ–¹å·®è§£é‡Šæ¯”ä¾‹: {sorted_eigenvalues / np.sum(sorted_eigenvalues)}")

# 5. æŠ•å½±åˆ°ç¬¬ä¸€ä¸»æˆåˆ†
pc1 = sorted_eigenvectors[:, 0]
data_1d = data_centered @ pc1
print(f"\né™ç»´åæ•°æ®å½¢çŠ¶: {data_1d.shape}")

print("""
ğŸ¯ PCA é™ç»´çš„æ­¥éª¤ï¼š
1. æ•°æ®ä¸­å¿ƒåŒ–ï¼ˆå‡å»å‡å€¼ï¼‰
2. è®¡ç®—åæ–¹å·®çŸ©é˜µ
3. ç‰¹å¾åˆ†è§£åæ–¹å·®çŸ©é˜µ
4. é€‰æ‹©å‰ k ä¸ªæœ€å¤§ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡
5. å°†æ•°æ®æŠ•å½±åˆ°è¿™äº›ç‰¹å¾å‘é‡ä¸Š
""")

# =============================================================================
# 7. ç»ƒä¹ é¢˜
# =============================================================================
print("=" * 50)
print("ã€ç»ƒä¹ é¢˜ã€‘")
print("=" * 50)

print("""
1. åˆ›å»ºä¸€ä¸ª 3x3 çš„éšæœºçŸ©é˜µï¼Œè®¡ç®—å…¶é€†çŸ©é˜µï¼Œå¹¶éªŒè¯ A @ Aâ»Â¹ = I

2. è§£çº¿æ€§æ–¹ç¨‹ç»„:
   x + 2y + 3z = 14
   2x + y + z = 7
   3x + 2y + z = 10

3. å¯¹çŸ©é˜µ [[4, 0], [0, 2]] è¿›è¡Œç‰¹å¾åˆ†è§£ï¼Œæ‰‹åŠ¨éªŒè¯ç»“æœ

4. è®¡ç®—å‘é‡ [1, 2, 3, 4, 5] çš„ L1 å’Œ L2 èŒƒæ•°

è¯·åœ¨ä¸‹æ–¹ç¼–å†™ä»£ç å®Œæˆç»ƒä¹ ...
""")

# === åœ¨è¿™é‡Œç¼–å†™ä½ çš„ç»ƒä¹ ä»£ç  ===
# ç»ƒä¹  1
# np.random.seed(42)
# A = np.random.rand(3, 3)
# print(f"çŸ©é˜µ A:\n{A}")
# A_inv = np.linalg.inv(A)
# print(f"é€†çŸ©é˜µ Aâ»Â¹:\n{A_inv}")
# print(f"éªŒè¯ A @ Aâ»Â¹ â‰ˆ I:\n{A @ A_inv}")

# ç»ƒä¹  2
# # x + 2y + 3z = 14
# # 2x + y + z = 7
# # 3x + 2y + z = 10
# A = np.array([[1, 2, 3], [2, 1, 1], [3, 2, 1]])
# b = np.array([14, 7, 10])
# x = np.linalg.solve(A, b)
# print(f"è§£: x={x[0]:.2f}, y={x[1]:.2f}, z={x[2]:.2f}")
# print(f"éªŒè¯ A @ x = {A @ x}")

# ç»ƒä¹  3
# A = np.array([[4, 0], [0, 2]])
# eigenvalues, eigenvectors = np.linalg.eig(A)
# print(f"çŸ©é˜µ A:\n{A}")
# print(f"ç‰¹å¾å€¼: {eigenvalues}")  # [4, 2]
# print(f"ç‰¹å¾å‘é‡:\n{eigenvectors}")  # [[1,0], [0,1]]
# # å¯¹è§’çŸ©é˜µçš„ç‰¹å¾å€¼å°±æ˜¯å¯¹è§’çº¿å…ƒç´ ï¼Œç‰¹å¾å‘é‡æ˜¯æ ‡å‡†åŸºå‘é‡

# ç»ƒä¹  4
# v = np.array([1, 2, 3, 4, 5])
# l1_norm = np.linalg.norm(v, ord=1)
# l2_norm = np.linalg.norm(v, ord=2)
# print(f"å‘é‡: {v}")
# print(f"L1 èŒƒæ•° = |1|+|2|+|3|+|4|+|5| = {l1_norm}")  # 15
# print(f"L2 èŒƒæ•° = âˆš(1Â²+2Â²+3Â²+4Â²+5Â²) = {l2_norm:.4f}")  # 7.4162

print("\nâœ… NumPy çº¿æ€§ä»£æ•°å®Œæˆï¼")
print("ä¸‹ä¸€æ­¥ï¼š04-pandas-basics.py - Pandas æ•°æ®å¤„ç†åŸºç¡€")
