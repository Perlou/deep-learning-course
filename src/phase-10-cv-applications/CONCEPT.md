# è®¡ç®—æœºè§†è§‰åº”ç”¨å®Œå…¨æŒ‡å—

## ğŸ“š ç›®å½•

- [ä¸€ã€ç›®æ ‡æ£€æµ‹åŸºç¡€](#ä¸€ç›®æ ‡æ£€æµ‹åŸºç¡€)
- [äºŒã€YOLOç³»åˆ—](#äºŒyoloç³»åˆ—)
- [ä¸‰ã€R-CNNç³»åˆ—](#ä¸‰r-cnnç³»åˆ—)
- [å››ã€å›¾åƒåˆ†å‰²](#å››å›¾åƒåˆ†å‰²)
- [äº”ã€U-Netæ¶æ„](#äº”u-netæ¶æ„)
- [å…­ã€å®ä¾‹åˆ†å‰²](#å…­å®ä¾‹åˆ†å‰²)
- [ä¸ƒã€å§¿æ€ä¼°è®¡](#ä¸ƒå§¿æ€ä¼°è®¡)
- [å…«ã€äººè„¸è¯†åˆ«](#å…«äººè„¸è¯†åˆ«)

---

## ä¸€ã€ç›®æ ‡æ£€æµ‹åŸºç¡€

### 1.1 ä»€ä¹ˆæ˜¯ç›®æ ‡æ£€æµ‹ï¼Ÿ

ç›®æ ‡æ£€æµ‹ = **åˆ†ç±»** + **å®šä½**

```
è¾“å…¥å›¾åƒ                      è¾“å‡ºç»“æœ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚          â”‚   â”Œâ”€â”€â”€â”€â”€â”       â”‚
â”‚    ğŸ±    ğŸ•     â”‚    â†’     â”‚   â”‚ çŒ«  â”‚  ğŸ•   â”‚
â”‚                 â”‚          â”‚   â””â”€â”€â”€â”€â”€â”˜ â”Œâ”€â”€â”€â” â”‚
â”‚                 â”‚          â”‚           â”‚ç‹— â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â””â”€â”€â”€â”˜â”€â”˜

è¾“å‡º: [(ç±»åˆ«, ç½®ä¿¡åº¦, x, y, w, h), ...]
```

### 1.2 æ ¸å¿ƒæ¦‚å¿µ

#### è¾¹ç•Œæ¡† (Bounding Box)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (x1, y1)               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚    â”‚          â”‚        â”‚
â”‚    â”‚   ç‰©ä½“   â”‚ h      â”‚
â”‚    â”‚          â”‚        â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         w    (x2, y2)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¡¨ç¤ºæ–¹å¼:
1. (x1, y1, x2, y2) - å·¦ä¸Šè§’å’Œå³ä¸‹è§’åæ ‡
2. (x, y, w, h) - ä¸­å¿ƒç‚¹åæ ‡å’Œå®½é«˜
```

#### IoU (Intersection over Union)

```
        é¢„æµ‹æ¡†          çœŸå®æ¡†
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚    â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”
       â”‚    â”‚////â”‚    â”‚
       â”‚    â”‚////â”‚    â”‚     IoU = äº¤é›†é¢ç§¯ / å¹¶é›†é¢ç§¯
       â””â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”˜    â”‚
            â”‚         â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IoU = 0: å®Œå…¨ä¸é‡å 
IoU = 1: å®Œå…¨é‡å 
IoU > 0.5: é€šå¸¸è®¤ä¸ºæ£€æµ‹æ­£ç¡®
```

```python
def calculate_iou(box1, box2):
    """è®¡ç®—ä¸¤ä¸ªè¾¹ç•Œæ¡†çš„IoU"""
    x1 = max(box1[0], box2[0])
    y1 = max(box1[1], box2[1])
    x2 = min(box1[2], box2[2])
    y2 = min(box1[3], box2[3])

    intersection = max(0, x2 - x1) * max(0, y2 - y1)
    area1 = (box1[2] - box1[0]) * (box1[3] - box1[1])
    area2 = (box2[2] - box2[0]) * (box2[3] - box2[1])
    union = area1 + area2 - intersection

    return intersection / union if union > 0 else 0
```

#### NMS (Non-Maximum Suppression)

```
é—®é¢˜: åŒä¸€ç‰©ä½“å¯èƒ½æœ‰å¤šä¸ªé‡å çš„æ£€æµ‹æ¡†

æ£€æµ‹ç»“æœ:                    NMSå:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”           â”‚         â”‚                 â”‚
â”‚ â”‚â”Œâ”€â”€â”¼â”  0.9     â”‚         â”‚   â”Œâ”€â”€â”€â”  0.9    â”‚
â”‚ â”‚â”‚  â”‚â”‚  0.8     â”‚   â†’     â”‚   â”‚   â”‚         â”‚
â”‚ â”‚â””â”€â”€â”¼â”˜  0.7     â”‚         â”‚   â””â”€â”€â”€â”˜         â”‚
â”‚ â””â”€â”€â”€â”˜           â”‚         â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤:
1. æŒ‰ç½®ä¿¡åº¦æ’åº
2. é€‰æ‹©æœ€é«˜ç½®ä¿¡åº¦çš„æ¡†
3. åˆ é™¤ä¸ä¹‹IoU > é˜ˆå€¼çš„å…¶ä»–æ¡†
4. é‡å¤ç›´åˆ°å¤„ç†å®Œæ‰€æœ‰æ¡†
```

```python
def nms(boxes, scores, iou_threshold=0.5):
    """éæå¤§å€¼æŠ‘åˆ¶"""
    indices = scores.argsort()[::-1]
    keep = []

    while len(indices) > 0:
        current = indices[0]
        keep.append(current)

        if len(indices) == 1:
            break

        ious = [calculate_iou(boxes[current], boxes[i])
                for i in indices[1:]]
        indices = indices[1:][np.array(ious) < iou_threshold]

    return keep
```

### 1.3 æ£€æµ‹å™¨åˆ†ç±»

```
ç›®æ ‡æ£€æµ‹å™¨
â”œâ”€â”€ ä¸¤é˜¶æ®µæ£€æµ‹å™¨ (Two-Stage)
â”‚   â”œâ”€â”€ R-CNN
â”‚   â”œâ”€â”€ Fast R-CNN
â”‚   â””â”€â”€ Faster R-CNN
â”‚   ç‰¹ç‚¹: å…ˆç”Ÿæˆå€™é€‰åŒºåŸŸ, å†åˆ†ç±»
â”‚   ä¼˜ç‚¹: å‡†ç¡®ç‡é«˜
â”‚   ç¼ºç‚¹: é€Ÿåº¦è¾ƒæ…¢
â”‚
â””â”€â”€ å•é˜¶æ®µæ£€æµ‹å™¨ (One-Stage)
    â”œâ”€â”€ YOLO ç³»åˆ—
    â”œâ”€â”€ SSD
    â””â”€â”€ RetinaNet
    ç‰¹ç‚¹: ç›´æ¥é¢„æµ‹ç±»åˆ«å’Œä½ç½®
    ä¼˜ç‚¹: é€Ÿåº¦å¿«
    ç¼ºç‚¹: å°ç›®æ ‡æ£€æµ‹ç›¸å¯¹è¾ƒå¼±
```

### 1.4 è¯„ä¼°æŒ‡æ ‡

```
           å®é™…æ­£ä¾‹    å®é™…è´Ÿä¾‹
é¢„æµ‹æ­£ä¾‹     TP          FP
é¢„æµ‹è´Ÿä¾‹     FN          TN

ç²¾ç¡®ç‡ Precision = TP / (TP + FP)  â†’ é¢„æµ‹ä¸ºæ­£çš„æœ‰å¤šå°‘æ˜¯å¯¹çš„
å¬å›ç‡ Recall = TP / (TP + FN)     â†’ å®é™…ä¸ºæ­£çš„æœ‰å¤šå°‘è¢«æ‰¾åˆ°

AP (Average Precision): PRæ›²çº¿ä¸‹é¢ç§¯
mAP (mean AP): æ‰€æœ‰ç±»åˆ«APçš„å¹³å‡å€¼
```

---

## äºŒã€YOLOç³»åˆ—

### 2.1 YOLOæ ¸å¿ƒæ€æƒ³

**You Only Look Once** - ä¸€æ¬¡å‰å‘ä¼ æ’­å®Œæˆæ£€æµ‹

```
ä¼ ç»Ÿæ–¹æ³•:
å›¾åƒ â†’ å€™é€‰åŒºåŸŸæå– â†’ CNNåˆ†ç±» â†’ NMS â†’ ç»“æœ
      (æ»‘åŠ¨çª—å£/é€‰æ‹©æ€§æœç´¢)     (å¤šæ¬¡)

YOLO:
å›¾åƒ â†’ CNN â†’ ç›´æ¥è¾“å‡ºæ‰€æœ‰æ£€æµ‹ç»“æœ â†’ NMS â†’ ç»“æœ
            (ä¸€æ¬¡å‰å‘ä¼ æ’­)
```

### 2.2 YOLOå·¥ä½œåŸç†

```
è¾“å…¥å›¾åƒåˆ’åˆ†ä¸º SÃ—S ç½‘æ ¼ (å¦‚ 7Ã—7)

â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚   â”‚   â”‚ ğŸ±â”‚   â”‚   â”‚   â”‚   â”‚  â† ç‰©ä½“ä¸­å¿ƒæ‰€åœ¨çš„ç½‘æ ¼è´Ÿè´£é¢„æµ‹è¯¥ç‰©ä½“
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚   â”‚   â”‚   â”‚   â”‚ ğŸ•â”‚   â”‚   â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜

æ¯ä¸ªç½‘æ ¼é¢„æµ‹:
- Bä¸ªè¾¹ç•Œæ¡† (x, y, w, h, confidence)
- Cä¸ªç±»åˆ«æ¦‚ç‡

è¾“å‡ºå¼ é‡: S Ã— S Ã— (B Ã— 5 + C)
ä¾‹å¦‚: 7 Ã— 7 Ã— (2 Ã— 5 + 20) = 7 Ã— 7 Ã— 30
```

### 2.3 YOLOç‰ˆæœ¬æ¼”è¿›

```
ç‰ˆæœ¬      å¹´ä»½    ç‰¹ç‚¹                          é€Ÿåº¦/ç²¾åº¦
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
YOLOv1   2016    å¼€åˆ›æ€§å·¥ä½œ                     å¿«/ä¸€èˆ¬
YOLOv2   2017    Batch Norm, Anchor Boxes      æ›´å¿«/æ›´å¥½
YOLOv3   2018    å¤šå°ºåº¦é¢„æµ‹, Darknet-53         å¹³è¡¡
YOLOv4   2020    CSP, PANet, æ•°æ®å¢å¼º           æ›´å¥½
YOLOv5   2020    PyTorchå®ç°, æ˜“ç”¨æ€§å¼º          å®ç”¨
YOLOv6   2022    RepVGG backbone               å·¥ä¸šçº§
YOLOv7   2022    E-ELAN, æ–°è®­ç»ƒæŠ€å·§             SOTA
YOLOv8   2023    Ultralyticsç»Ÿä¸€æ¡†æ¶            æœ€æ–°
```

### 2.4 Anchor Boxes

```
é—®é¢˜: ä¸åŒç‰©ä½“å½¢çŠ¶å·®å¼‚å¤§

è§£å†³: é¢„å®šä¹‰å¤šç§å½¢çŠ¶çš„å…ˆéªŒæ¡† (Anchors)

â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”
â”‚     â”‚  â”‚           â”‚  â”‚  â”‚
â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚     â”‚                 â”‚  â”‚
â””â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
æ­£æ–¹å½¢    æ¨ªå‘çŸ©å½¢       â””â”€â”€â”˜
                       ç«–å‘çŸ©å½¢

ç½‘ç»œé¢„æµ‹çš„æ˜¯ç›¸å¯¹äºAnchorçš„åç§»é‡:
tx, ty: ä¸­å¿ƒç‚¹åç§»
tw, th: å®½é«˜ç¼©æ”¾
```

### 2.5 YOLOv8ä½¿ç”¨ç¤ºä¾‹

```python
from ultralytics import YOLO

# åŠ è½½é¢„è®­ç»ƒæ¨¡å‹
model = YOLO('yolov8n.pt')  # n/s/m/l/x ä¸åŒå¤§å°

# å›¾åƒæ£€æµ‹
results = model('image.jpg')

# æ˜¾ç¤ºç»“æœ
for result in results:
    boxes = result.boxes
    for box in boxes:
        cls = int(box.cls[0])
        conf = float(box.conf[0])
        xyxy = box.xyxy[0].tolist()
        print(f"ç±»åˆ«: {model.names[cls]}, ç½®ä¿¡åº¦: {conf:.2f}")
        print(f"ä½ç½®: {xyxy}")

# è®­ç»ƒè‡ªå®šä¹‰æ•°æ®é›†
model.train(data='dataset.yaml', epochs=100)
```

**æ•°æ®é›†é…ç½® (dataset.yaml):**

```yaml
path: /path/to/dataset
train: images/train
val: images/val

names:
  0: person
  1: car
  2: dog
```

---

## ä¸‰ã€R-CNNç³»åˆ—

### 3.1 R-CNNæ¼”è¿›

```
R-CNN (2014) â†’ Fast R-CNN (2015) â†’ Faster R-CNN (2015)
   â†“                  â†“                    â†“
  æ…¢               è¾ƒå¿«                  å¿«
(47s/å›¾)         (2s/å›¾)             (0.2s/å›¾)
```

### 3.2 R-CNNåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      R-CNN                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  è¾“å…¥å›¾åƒ â†’ é€‰æ‹©æ€§æœç´¢ â†’ 2000ä¸ªå€™é€‰åŒºåŸŸ              â”‚
â”‚                â†“                                     â”‚
â”‚         æ¯ä¸ªåŒºåŸŸ â†’ ç¼©æ”¾åˆ°å›ºå®šå°ºå¯¸ â†’ CNN â†’ ç‰¹å¾        â”‚
â”‚                â†“                                     â”‚
â”‚              SVMåˆ†ç±» + è¾¹ç•Œæ¡†å›å½’                     â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜: 2000æ¬¡CNNå‰å‘ä¼ æ’­, éå¸¸æ…¢!
```

### 3.3 Fast R-CNN

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Fast R-CNN                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  è¾“å…¥å›¾åƒ â”€â”€â”€â”€â”€â”€â†’ CNN â”€â”€â”€â”€â”€â”€â†’ ç‰¹å¾å›¾                  â”‚
â”‚       â†“                                              â”‚
â”‚  é€‰æ‹©æ€§æœç´¢ â†’ å€™é€‰åŒºåŸŸ â†’ RoI Pooling â†’ FC â†’ åˆ†ç±»+å›å½’  â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ”¹è¿›: æ•´å¼ å›¾åªè¿‡ä¸€æ¬¡CNN, åœ¨ç‰¹å¾å›¾ä¸Šæå–åŒºåŸŸç‰¹å¾
```

#### RoI Pooling

```
ä¸åŒå¤§å°çš„RoI â†’ å›ºå®šå¤§å°çš„è¾“å‡º

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”¬â”€â”€â”€â”
â”‚   RoIåŒºåŸŸ   â”‚  â†’   â”‚   â”‚   â”‚   å›ºå®šå¤§å°
â”‚  (ä»»æ„å¤§å°) â”‚      â”œâ”€â”€â”€â”¼â”€â”€â”€â”¤   å¦‚ 2Ã—2
â”‚             â”‚      â”‚   â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”´â”€â”€â”€â”˜
```

### 3.4 Faster R-CNN

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Faster R-CNN                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  è¾“å…¥ â†’ Backbone (ResNet/VGG) â†’ ç‰¹å¾å›¾                    â”‚
â”‚                                    â†“                     â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚            â”‚      RPN (Region Proposal Network) â”‚        â”‚
â”‚            â”‚  åœ¨ç‰¹å¾å›¾ä¸Šæ»‘åŠ¨, é¢„æµ‹æ˜¯å¦ä¸ºç‰©ä½“+ä½ç½®  â”‚        â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                           â†“                              â”‚
â”‚               å€™é€‰åŒºåŸŸ (çº¦300ä¸ª)                          â”‚
â”‚                           â†“                              â”‚
â”‚              RoI Pooling â†’ FC â†’ åˆ†ç±» + ç²¾ç»†å›å½’           â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®æ”¹è¿›: ç”¨RPNæ›¿ä»£é€‰æ‹©æ€§æœç´¢, ç«¯åˆ°ç«¯è®­ç»ƒ
```

#### RPNè¯¦è§£

```
ç‰¹å¾å›¾ä¸Šæ¯ä¸ªä½ç½®:
- kä¸ªAnchors (ä¸åŒå°ºåº¦å’Œæ¯”ä¾‹)
- é¢„æµ‹: å‰æ™¯/èƒŒæ™¯å¾—åˆ† + è¾¹ç•Œæ¡†è°ƒæ•´

        Anchorç¤ºä¾‹ (k=9):
        â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
        â”‚   â”‚ â”‚     â”‚ â”‚       â”‚
        â””â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜
        1:1    1:2      1:3

        â”Œâ”€â”   â”Œâ”€â”€â”     â”Œâ”€â”€â”€â”
        â”‚ â”‚   â”‚  â”‚     â”‚   â”‚
        â”‚ â”‚   â”‚  â”‚     â”‚   â”‚
        â”‚ â”‚   â”‚  â”‚     â”‚   â”‚
        â””â”€â”˜   â””â”€â”€â”˜     â””â”€â”€â”€â”˜
        2:1   3:1    (ä¸åŒå°ºåº¦)
```

### 3.5 PyTorchå®ç°Faster R-CNN

```python
import torchvision
from torchvision.models.detection import fasterrcnn_resnet50_fpn

# åŠ è½½é¢„è®­ç»ƒæ¨¡å‹
model = fasterrcnn_resnet50_fpn(pretrained=True)
model.eval()

# æ¨ç†
import torch
from PIL import Image
from torchvision import transforms

image = Image.open('image.jpg')
transform = transforms.ToTensor()
x = transform(image).unsqueeze(0)

with torch.no_grad():
    predictions = model(x)

# predictions[0] åŒ…å«:
# - boxes: è¾¹ç•Œæ¡†åæ ‡
# - labels: ç±»åˆ«æ ‡ç­¾
# - scores: ç½®ä¿¡åº¦åˆ†æ•°
```

---

## å››ã€å›¾åƒåˆ†å‰²

### 4.1 åˆ†å‰²ä»»åŠ¡å¯¹æ¯”

```
è¯­ä¹‰åˆ†å‰² (Semantic Segmentation):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ¦ğŸŸ¦ğŸŸ¦ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ© â”‚   è“è‰² = å¤©ç©º
â”‚ ğŸŸ¦ğŸŸ¦ğŸŸ©ğŸŸ©ğŸŒ³ğŸŒ³ğŸŸ© â”‚   ç»¿è‰² = è‰åœ°
â”‚ ğŸŸ©ğŸŸ©ğŸ•ğŸ•ğŸŒ³ğŸŒ³ğŸŸ© â”‚   ğŸŒ³ = æ ‘
â”‚ ğŸŸ©ğŸ•ğŸ•ğŸ•ğŸŸ©ğŸŸ©ğŸŸ© â”‚   ğŸ• = ç‹— (ä¸åŒºåˆ†ä¸ªä½“)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®ä¾‹åˆ†å‰² (Instance Segmentation):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ¦ğŸŸ¦ğŸŸ¦ğŸŸ©ğŸŸ©ğŸŸ©ğŸŸ© â”‚
â”‚ ğŸŸ¦ğŸŸ¦ğŸŸ©ğŸŸ©ğŸŒ³ğŸŒ³ğŸŸ© â”‚   ä¸¤åªç‹—åˆ†åˆ«æ ‡è®°:
â”‚ ğŸŸ©ğŸŸ©ğŸ•1ğŸ•1ğŸŒ³ğŸŒ³ğŸŸ© â”‚   ğŸ•1 = ç‹—å®ä¾‹1 (çº¢è‰²)
â”‚ ğŸŸ©ğŸ•1ğŸ•1ğŸ•2ğŸ•2ğŸŸ© â”‚   ğŸ•2 = ç‹—å®ä¾‹2 (é»„è‰²)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…¨æ™¯åˆ†å‰² (Panoptic Segmentation):
= è¯­ä¹‰åˆ†å‰² + å®ä¾‹åˆ†å‰²
å¯¹æ‰€æœ‰åƒç´ åˆ†ç±», å¹¶åŒºåˆ†å®ä¾‹
```

### 4.2 è¯­ä¹‰åˆ†å‰²æ¶æ„

```
ç¼–ç å™¨-è§£ç å™¨ç»“æ„:

è¾“å…¥å›¾åƒ                                    è¾“å‡ºåˆ†å‰²å›¾
HÃ—WÃ—3                                      HÃ—WÃ—C (C=ç±»åˆ«æ•°)
  â”‚                                            â†‘
  â–¼                                            â”‚
â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”
â”‚     â”‚ â†’  â”‚    â”‚ â†’  â”‚   â”‚ â†’  â”‚    â”‚ â†’  â”‚     â”‚
â”‚     â”‚    â”‚    â”‚    â”‚   â”‚    â”‚    â”‚    â”‚     â”‚
â”‚     â”‚    â”‚    â”‚    â”‚   â”‚    â”‚    â”‚    â”‚     â”‚
â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜
 ç¼–ç å™¨ (ä¸‹é‡‡æ ·)     ç“¶é¢ˆå±‚      è§£ç å™¨ (ä¸Šé‡‡æ ·)
 æå–ç‰¹å¾                       æ¢å¤åˆ†è¾¨ç‡
```

### 4.3 FCN (Fully Convolutional Network)

```
å°†å…¨è¿æ¥å±‚æ›¿æ¢ä¸ºå·ç§¯å±‚:

ä¼ ç»ŸCNN:
... â†’ [7Ã—7Ã—512] â†’ Flatten â†’ FC â†’ FC â†’ 1000ç±»

FCN:
... â†’ [7Ã—7Ã—512] â†’ Conv1Ã—1 â†’ Conv1Ã—1 â†’ [7Ã—7Ã—1000]
                    â†“
              ä¸Šé‡‡æ ·åˆ°åŸå›¾å¤§å°
                    â†“
              [HÃ—WÃ—C] åˆ†å‰²å›¾
```

---

## äº”ã€U-Netæ¶æ„

### 5.1 U-Netç»“æ„

```
                        U-Net æ¶æ„å›¾

è¾“å…¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º è¾“å‡º
64Ã—64                                              64Ã—64
  â”‚                                                  â†‘
  â–¼                        Skip Connection          â”‚
â”Œâ”€â”€â”€â”€â” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”Œâ”€â”€â”€â”€â”
â”‚    â”‚ 32Ã—32                              32Ã—32   â”‚    â”‚
â””â”€â”€â”€â”€â”˜                                            â””â”€â”€â”€â”€â”˜
  â”‚                                                  â†‘
  â–¼                                                  â”‚
â”Œâ”€â”€â”€â”€â” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”Œâ”€â”€â”€â”€â”
â”‚    â”‚ 16Ã—16                              16Ã—16   â”‚    â”‚
â””â”€â”€â”€â”€â”˜                                            â””â”€â”€â”€â”€â”˜
  â”‚                                                  â†‘
  â–¼                                                  â”‚
â”Œâ”€â”€â”€â”€â” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”Œâ”€â”€â”€â”€â”
â”‚    â”‚ 8Ã—8                                  8Ã—8   â”‚    â”‚
â””â”€â”€â”€â”€â”˜                                            â””â”€â”€â”€â”€â”˜
  â”‚                                                  â†‘
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”Œâ”€â”€â”€â”€â” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚    â”‚ 4Ã—4 (ç“¶é¢ˆå±‚)
                    â””â”€â”€â”€â”€â”˜

å·¦ä¾§: ç¼–ç å™¨ (ä¸‹é‡‡æ ·, æå–ç‰¹å¾)
å³ä¾§: è§£ç å™¨ (ä¸Šé‡‡æ ·, æ¢å¤åˆ†è¾¨ç‡)
æ¨ªçº¿: Skip Connection (è·³è·ƒè¿æ¥, ä¿ç•™ç»†èŠ‚)
```

### 5.2 Skip Connectionçš„ä½œç”¨

```
é—®é¢˜: ä¸‹é‡‡æ ·è¿‡ç¨‹ä¸­ä¸¢å¤±ç©ºé—´ç»†èŠ‚ä¿¡æ¯

è§£å†³: å°†ç¼–ç å™¨çš„ç‰¹å¾å›¾ç›´æ¥ä¼ é€’ç»™è§£ç å™¨å¯¹åº”å±‚

æ•ˆæœ:
- ä¿ç•™ç²¾ç»†çš„è¾¹ç•Œä¿¡æ¯
- å¸®åŠ©å®šä½
- èåˆä½å±‚ç»†èŠ‚å’Œé«˜å±‚è¯­ä¹‰
```

### 5.3 PyTorchå®ç°U-Net

```python
import torch
import torch.nn as nn

class DoubleConv(nn.Module):
    """ä¸¤æ¬¡å·ç§¯å—: (Conv â†’ BN â†’ ReLU) Ã— 2"""
    def __init__(self, in_ch, out_ch):
        super().__init__()
        self.conv = nn.Sequential(
            nn.Conv2d(in_ch, out_ch, 3, padding=1),
            nn.BatchNorm2d(out_ch),
            nn.ReLU(inplace=True),
            nn.Conv2d(out_ch, out_ch, 3, padding=1),
            nn.BatchNorm2d(out_ch),
            nn.ReLU(inplace=True)
        )

    def forward(self, x):
        return self.conv(x)


class UNet(nn.Module):
    def __init__(self, in_channels=3, num_classes=2):
        super().__init__()

        # ç¼–ç å™¨
        self.enc1 = DoubleConv(in_channels, 64)
        self.enc2 = DoubleConv(64, 128)
        self.enc3 = DoubleConv(128, 256)
        self.enc4 = DoubleConv(256, 512)

        self.pool = nn.MaxPool2d(2)

        # ç“¶é¢ˆå±‚
        self.bottleneck = DoubleConv(512, 1024)

        # è§£ç å™¨
        self.up4 = nn.ConvTranspose2d(1024, 512, 2, stride=2)
        self.dec4 = DoubleConv(1024, 512)

        self.up3 = nn.ConvTranspose2d(512, 256, 2, stride=2)
        self.dec3 = DoubleConv(512, 256)

        self.up2 = nn.ConvTranspose2d(256, 128, 2, stride=2)
        self.dec2 = DoubleConv(256, 128)

        self.up1 = nn.ConvTranspose2d(128, 64, 2, stride=2)
        self.dec1 = DoubleConv(128, 64)

        # è¾“å‡ºå±‚
        self.out = nn.Conv2d(64, num_classes, 1)

    def forward(self, x):
        # ç¼–ç 
        e1 = self.enc1(x)
        e2 = self.enc2(self.pool(e1))
        e3 = self.enc3(self.pool(e2))
        e4 = self.enc4(self.pool(e3))

        # ç“¶é¢ˆ
        b = self.bottleneck(self.pool(e4))

        # è§£ç  (å¸¦Skip Connection)
        d4 = self.dec4(torch.cat([self.up4(b), e4], dim=1))
        d3 = self.dec3(torch.cat([self.up3(d4), e3], dim=1))
        d2 = self.dec2(torch.cat([self.up2(d3), e2], dim=1))
        d1 = self.dec1(torch.cat([self.up1(d2), e1], dim=1))

        return self.out(d1)
```

### 5.4 åˆ†å‰²æŸå¤±å‡½æ•°

```python
# 1. äº¤å‰ç†µæŸå¤± (åƒç´ çº§åˆ†ç±»)
criterion = nn.CrossEntropyLoss()

# 2. Dice Loss (å¤„ç†ç±»åˆ«ä¸å¹³è¡¡)
class DiceLoss(nn.Module):
    def forward(self, pred, target, smooth=1e-5):
        pred = torch.softmax(pred, dim=1)
        intersection = (pred * target).sum(dim=(2, 3))
        union = pred.sum(dim=(2, 3)) + target.sum(dim=(2, 3))
        dice = (2 * intersection + smooth) / (union + smooth)
        return 1 - dice.mean()

# 3. ç»„åˆæŸå¤±
total_loss = 0.5 * ce_loss + 0.5 * dice_loss
```

---

## å…­ã€å®ä¾‹åˆ†å‰²

### 6.1 Mask R-CNN

```
Mask R-CNN = Faster R-CNN + åˆ†å‰²åˆ†æ”¯

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Mask R-CNN                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  Backbone â†’ FPN â†’ RPN â†’ RoI Align â†’ FC â†’ åˆ†ç±»+å›å½’  â”‚
â”‚                            â†“                        â”‚
â”‚                       Mask Head â†’ åˆ†å‰²æ©ç           â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¾“å‡º:
- è¾¹ç•Œæ¡†
- ç±»åˆ«
- ç½®ä¿¡åº¦
- å®ä¾‹æ©ç  (æ¯ä¸ªå®ä¾‹ä¸€ä¸ª)
```

### 6.2 RoI Align vs RoI Pooling

```
RoI Poolingé—®é¢˜: é‡åŒ–è¯¯å·®å¯¼è‡´æ©ç ä¸ç²¾ç¡®

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     é‡åŒ–      â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚     RoI       â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚     â”‚     â”‚
â”‚   (æµ®ç‚¹åæ ‡)   â”‚    å–æ•´       â”‚     â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜

RoI Alignè§£å†³: ä½¿ç”¨åŒçº¿æ€§æ’å€¼, æ— é‡åŒ–

ç‰¹å¾å›¾ä½ç½®    åŒçº¿æ€§æ’å€¼    ç²¾ç¡®é‡‡æ ·
   â€¢              â†“            â€¢
   â€¢    â†’    è®¡ç®—å‘¨å›´4ç‚¹    â†’  â€¢
   â€¢         åŠ æƒå¹³å‡          â€¢
```

### 6.3 PyTorchä½¿ç”¨Mask R-CNN

```python
import torchvision
from torchvision.models.detection import maskrcnn_resnet50_fpn

# åŠ è½½é¢„è®­ç»ƒæ¨¡å‹
model = maskrcnn_resnet50_fpn(pretrained=True)
model.eval()

# æ¨ç†
image = transform(Image.open('image.jpg')).unsqueeze(0)

with torch.no_grad():
    predictions = model(image)

# predictions[0] åŒ…å«:
# - boxes: è¾¹ç•Œæ¡†
# - labels: ç±»åˆ«
# - scores: ç½®ä¿¡åº¦
# - masks: å®ä¾‹æ©ç  [N, 1, H, W]

# å¯è§†åŒ–æ©ç 
masks = predictions[0]['masks'] > 0.5
for i, mask in enumerate(masks):
    # mask shape: [1, H, W]
    plt.imshow(mask[0], alpha=0.5)
```

---

## ä¸ƒã€å§¿æ€ä¼°è®¡

### 7.1 ä»€ä¹ˆæ˜¯å§¿æ€ä¼°è®¡

```
æ£€æµ‹äººä½“å…³é”®ç‚¹ (keypoints) çš„ä½ç½®

         å¤´ (0)
          â”‚
    è‚© (5)â”¼(6) è‚©
     â”‚    â”‚    â”‚
  è‚˜ (7)  â”‚  (8) è‚˜
     â”‚    â”‚    â”‚
  è…• (9)  â”‚  (10) è…•
          â”‚
    é«‹ (11)â”¼(12) é«‹
     â”‚         â”‚
  è† (13)    (14) è†
     â”‚         â”‚
  è¸ (15)    (16) è¸

å¸¸è§æ ¼å¼: COCO (17ä¸ªå…³é”®ç‚¹)
```

### 7.2 å§¿æ€ä¼°è®¡æ–¹æ³•

```
æ–¹æ³•åˆ†ç±»:

1. Top-Down (è‡ªé¡¶å‘ä¸‹):
   å…ˆæ£€æµ‹äºº â†’ å†å¯¹æ¯ä¸ªäººä¼°è®¡å§¿æ€
   ç²¾åº¦é«˜, é€Ÿåº¦å–å†³äºäººæ•°
   ä»£è¡¨: HRNet, SimpleBaseline

2. Bottom-Up (è‡ªåº•å‘ä¸Š):
   å…ˆæ£€æµ‹æ‰€æœ‰å…³é”®ç‚¹ â†’ å†ç»„åˆæˆäºº
   é€Ÿåº¦å¿«, é€‚åˆå¤šäººåœºæ™¯
   ä»£è¡¨: OpenPose, HigherHRNet
```

### 7.3 çƒ­åŠ›å›¾æ–¹æ³•

```
ä¸ºæ¯ä¸ªå…³é”®ç‚¹ç”Ÿæˆçƒ­åŠ›å›¾ (Heatmap)

è¾“å…¥å›¾åƒ â†’ CNN â†’ Kä¸ªçƒ­åŠ›å›¾ (K=å…³é”®ç‚¹æ•°)

çƒ­åŠ›å›¾ç¤ºä¾‹ (å³æ‰‹è…•):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0.0 0.0 0.0 0.0   â”‚
â”‚ 0.0 0.2 0.4 0.1   â”‚
â”‚ 0.0 0.5 â—1.0 0.3  â”‚  â† æœ€å¤§å€¼ä½ç½® = å…³é”®ç‚¹ä½ç½®
â”‚ 0.0 0.1 0.3 0.1   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è®­ç»ƒæ—¶: ç”Ÿæˆé«˜æ–¯çƒ­åŠ›å›¾ä½œä¸ºæ ‡ç­¾
æ¨ç†æ—¶: æ‰¾çƒ­åŠ›å›¾æœ€å¤§å€¼ä½ç½®
```

### 7.4 ä½¿ç”¨ç¤ºä¾‹

```python
import torch
from torchvision.models.detection import keypointrcnn_resnet50_fpn

# åŠ è½½å…³é”®ç‚¹æ£€æµ‹æ¨¡å‹
model = keypointrcnn_resnet50_fpn(pretrained=True)
model.eval()

# æ¨ç†
with torch.no_grad():
    predictions = model(images)

# predictions[0] åŒ…å«:
# - boxes: äººä½“è¾¹ç•Œæ¡†
# - keypoints: å…³é”®ç‚¹ [N, K, 3] (x, y, visibility)
# - keypoints_scores: å…³é”®ç‚¹ç½®ä¿¡åº¦

# å¯è§†åŒ–éª¨æ¶
keypoints = predictions[0]['keypoints'][0]  # ç¬¬ä¸€ä¸ªäºº
connections = [(5, 7), (7, 9), (6, 8), (8, 10), ...]  # éª¨æ¶è¿æ¥
for (i, j) in connections:
    plt.plot([keypoints[i, 0], keypoints[j, 0]],
             [keypoints[i, 1], keypoints[j, 1]])
```

---

## å…«ã€äººè„¸è¯†åˆ«

### 8.1 äººè„¸è¯†åˆ«æµç¨‹

```
å®Œæ•´æµç¨‹:

1. äººè„¸æ£€æµ‹          2. äººè„¸å¯¹é½         3. ç‰¹å¾æå–        4. ç‰¹å¾åŒ¹é…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ“·    â”‚  â†’      â”‚   ğŸ”²    â”‚  â†’     â”‚         â”‚  â†’    â”‚  å¯¹æ¯”   â”‚
â”‚  æ£€æµ‹æ¡†  â”‚         â”‚ æ ‡å‡†åŒ–  â”‚        â”‚  512ç»´  â”‚       â”‚  å†³ç­–   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  å‘é‡   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 äººè„¸æ£€æµ‹

```python
# ä½¿ç”¨ MTCNN
from facenet_pytorch import MTCNN

mtcnn = MTCNN(keep_all=True)
boxes, probs, landmarks = mtcnn.detect(image, landmarks=True)

# boxes: äººè„¸è¾¹ç•Œæ¡†
# landmarks: 5ä¸ªå…³é”®ç‚¹ (çœ¼ç›Ã—2, é¼»å­, å˜´è§’Ã—2)
```

### 8.3 äººè„¸ç‰¹å¾æå–

```python
from facenet_pytorch import InceptionResnetV1

# åŠ è½½é¢„è®­ç»ƒæ¨¡å‹
resnet = InceptionResnetV1(pretrained='vggface2').eval()

# æå–ç‰¹å¾ (éœ€è¦å…ˆå¯¹é½è£å‰ª)
face_aligned = mtcnn(image)  # è¿”å›å¯¹é½åçš„äººè„¸
embedding = resnet(face_aligned.unsqueeze(0))

# embedding shape: [1, 512]
```

### 8.4 äººè„¸åŒ¹é…

```python
import torch.nn.functional as F

def compare_faces(emb1, emb2, threshold=0.6):
    """æ¯”è¾ƒä¸¤ä¸ªäººè„¸ç‰¹å¾"""
    # è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
    similarity = F.cosine_similarity(emb1, emb2)

    # æˆ–è®¡ç®—æ¬§æ°è·ç¦»
    distance = torch.dist(emb1, emb2)

    return similarity > threshold  # æ˜¯å¦ä¸ºåŒä¸€äºº

# 1:N äººè„¸æœç´¢
def search_face(query_emb, database_embs, top_k=5):
    """åœ¨æ•°æ®åº“ä¸­æœç´¢æœ€ç›¸ä¼¼çš„äººè„¸"""
    similarities = F.cosine_similarity(
        query_emb.unsqueeze(0),
        database_embs
    )
    top_indices = similarities.topk(top_k).indices
    return top_indices
```

### 8.5 æŸå¤±å‡½æ•°

```
Triplet Loss:

    Anchor (é”šç‚¹)
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”
   â”‚       â”‚
Positive  Negative
 (åŒäºº)    (ä¸åŒäºº)

ç›®æ ‡: d(A,P) + margin < d(A,N)

ä½¿åŒä¸€äººçš„è·ç¦»æ›´è¿‘, ä¸åŒäººçš„è·ç¦»æ›´è¿œ
```

```python
class TripletLoss(nn.Module):
    def __init__(self, margin=0.2):
        super().__init__()
        self.margin = margin

    def forward(self, anchor, positive, negative):
        pos_dist = F.pairwise_distance(anchor, positive)
        neg_dist = F.pairwise_distance(anchor, negative)
        loss = F.relu(pos_dist - neg_dist + self.margin)
        return loss.mean()
```

---

## ğŸ¯ æ€»ç»“å¯¹æ¯”

### CVä»»åŠ¡å¯¹æ¯”

| ä»»åŠ¡     | è¾“å…¥     | è¾“å‡º            | ä»£è¡¨æ¨¡å‹          |
| -------- | -------- | --------------- | ----------------- |
| å›¾åƒåˆ†ç±» | å›¾åƒ     | ç±»åˆ«æ ‡ç­¾        | ResNet, ViT       |
| ç›®æ ‡æ£€æµ‹ | å›¾åƒ     | è¾¹ç•Œæ¡† + ç±»åˆ«   | YOLO, Faster RCNN |
| è¯­ä¹‰åˆ†å‰² | å›¾åƒ     | åƒç´ çº§ç±»åˆ«      | U-Net, DeepLab    |
| å®ä¾‹åˆ†å‰² | å›¾åƒ     | å®ä¾‹æ©ç  + ç±»åˆ« | Mask R-CNN        |
| å§¿æ€ä¼°è®¡ | å›¾åƒ     | å…³é”®ç‚¹åæ ‡      | HRNet, OpenPose   |
| äººè„¸è¯†åˆ« | äººè„¸å›¾åƒ | ç‰¹å¾å‘é‡/èº«ä»½   | FaceNet, ArcFace  |

### é€‰æ‹©æŒ‡å—

```
ç›®æ ‡æ£€æµ‹:
â”œâ”€â”€ è¿½æ±‚é€Ÿåº¦ â†’ YOLOv8
â”œâ”€â”€ è¿½æ±‚ç²¾åº¦ â†’ Faster R-CNN
â””â”€â”€ è½»é‡éƒ¨ç½² â†’ YOLOv8-nano, MobileNet-SSD

å›¾åƒåˆ†å‰²:
â”œâ”€â”€ åŒ»å­¦å›¾åƒ â†’ U-Net
â”œâ”€â”€ é€šç”¨åœºæ™¯ â†’ DeepLabv3+
â””â”€â”€ å®ä¾‹åˆ†å‰² â†’ Mask R-CNN

å§¿æ€ä¼°è®¡:
â”œâ”€â”€ å•äººé«˜ç²¾åº¦ â†’ HRNet
â””â”€â”€ å¤šäººå®æ—¶ â†’ OpenPose, MediaPipe

äººè„¸è¯†åˆ«:
â”œâ”€â”€ æ£€æµ‹ â†’ MTCNN, RetinaFace
â””â”€â”€ è¯†åˆ« â†’ ArcFace, FaceNet
```

---

## ğŸ“– æ¨èé˜…è¯»

- **ç›®æ ‡æ£€æµ‹**: YOLOç³»åˆ—è®ºæ–‡, Faster R-CNN
- **å›¾åƒåˆ†å‰²**: U-Net, DeepLabç³»åˆ—
- **å®ä¾‹åˆ†å‰²**: Mask R-CNN
- **å§¿æ€ä¼°è®¡**: OpenPose, HRNet
- **äººè„¸è¯†åˆ«**: FaceNet, ArcFace
